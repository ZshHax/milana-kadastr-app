import streamlit as st
import pandas as pd
import plotly.express as px
import numpy as np
import os

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–®–∏—Ä–æ–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
st.set_page_config(page_title="–ê–ò–°: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ó–µ–º–µ–ª—å", page_icon="üåç", layout="wide")

# ==========================================
# –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨
# ==========================================
with st.sidebar:
    # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø (–µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–∫–∏–Ω—É—Ç –≤ GitHub)
    if os.path.exists("logo.jpg"):
        st.image("logo.jpg", use_column_width=True)
    elif os.path.exists("logo.png"):
        st.image("logo.png", use_column_width=True)
        
    st.markdown("<h2 style='text-align: center; color: #4B0082;'>–Æ–ö–£ –∏–º. –ú. –ê—É—ç–∑–æ–≤–∞</h2>", unsafe_allow_html=True)
    st.markdown("---")
    st.markdown("### üéì –ü–∞—Å–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞")
    st.markdown("**–í—ã–ø–æ–ª–Ω–∏–ª–∞:** –ö–æ—à–∞–Ω–æ–≤–∞ –ú.–ó.")
    st.markdown("**–§–∞–∫—É–ª—å—Ç–µ—Ç:** –ê–≥—Ä–∞—Ä–Ω—ã–π")
    st.markdown("**–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:** –ö–∞–¥–∞—Å—Ç—Ä")
    st.markdown("**–ì—Ä—É–ø–ø–∞:** –ê–ø 24-6—Ä")
    st.markdown("---")
    st.markdown("**–ë–∞–∑–∞:** –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–µ–º–µ–ª—å–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏")
    st.markdown("**–¢–µ–º–∞:** –†–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–µ–º–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤")

# ==========================================
# –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨
# ==========================================
st.title("üåç –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —Ñ–æ–Ω–¥–∞")
st.markdown("–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —É—á–µ—Ç–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∑–µ–º–µ–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.")

# KPI –ú–µ—Ç—Ä–∏–∫–∏ (—Å–≤–µ—Ä—Ö—É)
col1, col2, col3, col4 = st.columns(4)
col1.metric("–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å (—Ç—ã—Å. –≥–∞)", "1 250", "+12.5%")
col2.metric("–í —Å–µ–ª—å—Ö–æ–∑–æ–±–æ—Ä–æ—Ç–µ (—Ç—ã—Å. –≥–∞)", "840", "-2.1%")
col3.metric("–í—ã—è–≤–ª–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π", "142", "+14")
col4.metric("–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤ (–º–ª–Ω ‚Ç∏)", "28.5", "+4.2")

st.markdown("---")

# –í–∫–ª–∞–¥–∫–∏
tab1, tab2, tab3, tab4 = st.tabs(["üó∫Ô∏è –ö–∞—Ä—Ç–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π", "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞", "üóÑÔ∏è –†–µ–µ—Å—Ç—Ä —É—á–∞—Å—Ç–∫–æ–≤", "üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–∞–Ω–∫—Ü–∏–π"])

with tab1:
    st.subheader("–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π (–¢—É—Ä–∫–µ—Å—Ç–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å / –®—ã–º–∫–µ–Ω—Ç)")
    st.markdown("–ö—Ä–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –æ–±–æ–∑–Ω–∞—á–∞—é—Ç —É—á–∞—Å—Ç–∫–∏ —Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–µ—Ü–µ–ª–µ–≤—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–ª–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–µ–π.")
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–µ–π–∫–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–æ–∫—Ä—É–≥ –®—ã–º–∫–µ–Ω—Ç–∞ (–®–∏—Ä–æ—Ç–∞ ~42.3, –î–æ–ª–≥–æ—Ç–∞ ~69.6)
    np.random.seed(42)
    map_data = pd.DataFrame(
        np.random.randn(50, 2) / [50, 50] + [42.314, 69.589],
        columns=['lat', 'lon']
    )
    # –í—ã–≤–æ–¥–∏–º –∫–∞—Ä—Ç—É
    st.map(map_data, zoom=10, color="#FF0000")

with tab2:
    col1, col2 = st.columns(2)
    with col1:
        st.subheader("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —Ñ–æ–Ω–¥–∞")
        df_pie = pd.DataFrame({
            '–ö–∞—Ç–µ–≥–æ—Ä–∏—è': ['–ü–∞—à–Ω–∏', '–ü–∞—Å—Ç–±–∏—â–∞', '–ó–µ–º–ª–∏ –∑–∞–ø–∞—Å–∞', '–ó–µ–º–ª–∏ –Ω–∞—Å. –ø—É–Ω–∫—Ç–æ–≤', '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å'],
            '–ü–ª–æ—â–∞–¥—å': [450, 320, 150, 120, 80]
        })
        fig_pie = px.pie(df_pie, values='–ü–ª–æ—â–∞–¥—å', names='–ö–∞—Ç–µ–≥–æ—Ä–∏—è', hole=0.4, 
                         color_discrete_sequence=px.colors.sequential.Agsunset)
        st.plotly_chart(fig_pie, use_container_width=True)
        
    with col2:
        st.subheader("–î–∏–Ω–∞–º–∏–∫–∞ –≤—ã—è–≤–ª–µ–Ω–∏—è –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ –≥–æ–¥–∞–º")
        df_bar = pd.DataFrame({
            '–ì–æ–¥': ['2023', '2024', '2025', '2026 (1 –∫–≤.)'],
            '–ù–µ—Ü–µ–ª–µ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ': [45, 60, 52, 18],
            '–°–∞–º–æ–≤–æ–ª—å–Ω—ã–π –∑–∞—Ö–≤–∞—Ç': [20, 25, 30, 8]
        })
        fig_bar = px.bar(df_bar, x='–ì–æ–¥', y=['–ù–µ—Ü–µ–ª–µ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ', '–°–∞–º–æ–≤–æ–ª—å–Ω—ã–π –∑–∞—Ö–≤–∞—Ç'], barmode='group')
        st.plotly_chart(fig_bar, use_container_width=True)

with tab3:
    st.subheader("–†–µ–µ—Å—Ç—Ä –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π")
    # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    df_db = pd.DataFrame({
        '–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä': ['19-322-045-121', '19-322-045-877', '19-322-011-002', '19-322-099-443', '19-322-012-105'],
        '–†–∞–π–æ–Ω/–ì–æ—Ä–æ–¥': ['–ï–Ω–±–µ–∫—à–∏–Ω—Å–∫–∏–π —Ä-–Ω', '–ê–±–∞–π—Å–∫–∏–π —Ä-–Ω', '–°–∞–π—Ä–∞–º—Å–∫–∏–π —Ä-–Ω', '–ê–ª—å-–§–∞—Ä–∞–±–∏–π—Å–∫–∏–π —Ä-–Ω', '–¢–æ–ª–µ–±–∏–π—Å–∫–∏–π —Ä-–Ω'],
        '–ü–ª–æ—â–∞–¥—å (–≥–∞)': [12.5, 0.8, 45.0, 0.15, 120.0],
        '–°—Ç–∞—Ç—É—Å': ['–í—ã–¥–∞–Ω–æ –ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏–µ', '–°—É–¥–µ–±–Ω–æ–µ —Ä–∞–∑–±–∏—Ä–∞—Ç–µ–ª—å—Å—Ç–≤–æ', '–ò–∑—ä—è—Ç–æ –≤ –≥–æ—Å—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å', '–®—Ç—Ä–∞—Ñ –æ–ø–ª–∞—á–µ–Ω', '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ']
    })
    # Streamlit dataframe –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã –ø—Ä—è–º–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    st.dataframe(df_db, use_container_width=True, hide_index=True)

with tab4:
    st.subheader("–ú–æ–¥—É–ª—å —Ä–∞—Å—á–µ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –≤–∑—ã—Å–∫–∞–Ω–∏–π")
    
    col1, col2 = st.columns([1, 1])
    with col1:
        area = st.number_input("–ü–ª–æ—â–∞–¥—å (–≥–∞):", min_value=0.1, value=5.0, step=0.5)
        violation_type = st.selectbox("–¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è:", ["–ù–µ—Ü–µ–ª–µ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ", "–ü–æ—Ä—á–∞ –∑–µ–º–µ–ª—å", "–°–∞–º–æ–≤–æ–ª—å–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ"])
        subject = st.radio("–°—É–±—ä–µ–∫—Ç:", ["–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ", "–ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å", "–ö—Ä—É–ø–Ω–æ–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ"])

    with col2:
        st.markdown("#### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç")
        mrp = 3932 # –ú–†–ü 2026
        
        multiplier = 10
        if subject == "–ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å": multiplier = 40
        elif subject == "–ö—Ä—É–ø–Ω–æ–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ": multiplier = 100
        
        if violation_type == "–ü–æ—Ä—á–∞ –∑–µ–º–µ–ª—å": multiplier *= 1.5
        elif violation_type == "–°–∞–º–æ–≤–æ–ª—å–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ": multiplier *= 2
        
        total_fine = int((mrp * multiplier) * (1 + (area * 0.1)))
        
        st.info("–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å—Ç–∞–≤–∫—É –ú–†–ü, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—É–±—ä–µ–∫—Ç–∞ –∏ –ø–æ–ø—Ä–∞–≤–æ—á–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–ª–æ—â–∞–¥–∏.")
        st.metric(label="–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (–¢–µ–Ω–≥–µ):", value=f"{total_fine:,}".replace(',', ' '))
